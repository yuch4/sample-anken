# 営業案件管理システム - 完全版要件定義書

すべての情報が揃いました！以下、包括的な要件定義書を作成いたします。

---

## 1. システム概要

### 1.1 プロジェクト名
**営業案件管理システム (Sales Pipeline Manager)**

### 1.2 目的
営業チーム（20名）の案件管理と数字管理を一元化し、以下を実現：
- 案件の進捗状況をリアルタイムで可視化
- 売上・粗利の予実管理を効率化
- 報告業務の工数削減

### 1.3 対象ユーザー
- **営業担当者**: 案件登録・更新、活動履歴記録
- **営業マネージャー**: チーム全体の進捗確認、目標達成率モニタリング
- **管理者**: ユーザー管理、目標設定

### 1.4 システム規模
- 利用人数: 20名
- 組織構造: 単一部署（シングルテナント）
- 案件数想定: 年間200〜500件

---

## 2. 機能要件

### 2.1 案件管理機能

| 要件ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| FR-001 | 案件登録 | 新規案件を登録（企業名、担当者、売上、粗利、確度、カテゴリ、受注予定月、計上予定月） | 必須 |
| FR-002 | 案件編集 | 既存案件の情報を更新 | 必須 |
| FR-003 | 案件削除 | 案件を論理削除（アーカイブ） | 必須 |
| FR-004 | ステータス管理 | リード→商談→提案→受注/失注のステージ遷移 | 必須 |
| FR-005 | 活動履歴記録 | 案件ごとに訪問・商談メモをタイムスタンプ付きで記録 | 必須 |
| FR-006 | 案件検索・フィルタ | 企業名、担当者、ステータス、カテゴリ、受注予定月で絞り込み | 必須 |
| FR-007 | 案件詳細表示 | 案件の全情報と活動履歴を一覧表示 | 必須 |

### 2.2 数字管理・ダッシュボード機能

| 要件ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| FR-101 | 売上実績表示 | 当月の受注済み案件の売上合計 | 必須 |
| FR-102 | 粗利実績表示 | 当月の受注済み案件の粗利合計 | 必須 |
| FR-103 | 予算比表示 | 目標値に対する達成率（売上・粗利） | 必須 |
| FR-104 | 案件数表示 | ステータス別の案件数（商談中/受注/失注） | 必須 |
| FR-105 | 売上予測表示 | 未受注案件の売上×確度の合計 | 推奨 |
| FR-106 | 月次推移グラフ | 過去6ヶ月の売上・粗利推移を折れ線グラフ表示 | 推奨 |
| FR-107 | 担当者別集計 | 担当者ごとの売上・案件数をテーブル表示 | 必須 |
| FR-108 | カテゴリ別集計 | 案件カテゴリごとの売上・案件数を円グラフ表示 | 推奨 |

### 2.3 目標管理機能

| 要件ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| FR-201 | 月次目標設定 | 月ごとに売上・粗利目標を設定 | 必須 |
| FR-202 | 担当者目標設定 | 個人別に月次目標を設定（オプション） | 推奨 |
| FR-203 | 目標編集 | 過去の目標値を修正可能 | 必須 |

### 2.4 データエクスポート機能

| 要件ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| FR-301 | 案件リストエクスポート | 現在の検索結果をExcel/CSV形式でダウンロード | 必須 |
| FR-302 | 集計データエクスポート | 月次集計・担当者別集計をExcel形式でダウンロード | 必須 |

### 2.5 ユーザー管理機能

| 要件ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| FR-401 | ログイン/ログアウト | メールアドレス＋パスワード認証（Supabase Auth） | 必須 |
| FR-402 | ユーザー登録 | 管理者が新規ユーザーを追加 | 必須 |
| FR-403 | 権限管理 | 一般ユーザー/マネージャー/管理者の3段階 | 推奨 |

---

## 3. 非機能要件

### 3.1 パフォーマンス

| 要件ID | 項目 | 要求 |
|--------|------|------|
| NFR-001 | 画面表示速度 | 初回ロード3秒以内、ページ遷移1秒以内 |
| NFR-002 | 同時接続数 | 20名が同時アクセス可能 |

### 3.2 セキュリティ

| 要件ID | 項目 | 要求 |
|--------|------|------|
| NFR-101 | 認証 | Supabase認証によるセッション管理 |
| NFR-102 | データアクセス制御 | Row Level Security（RLS）でユーザーごとのデータ分離 |
| NFR-103 | 通信暗号化 | HTTPS通信必須 |

### 3.3 可用性・スケーラビリティ

| 要件ID | 項目 | 要求 |
|--------|------|------|
| NFR-201 | 稼働率 | 99%以上（Vercel/Supabaseの標準SLA） |
| NFR-202 | バックアップ | Supabaseの自動バックアップ（日次） |
| NFR-203 | 将来拡張 | 利用人数50名まで対応可能な設計 |

### 3.4 ユーザビリティ

| 要件ID | 項目 | 要求 |
|--------|------|------|
| NFR-301 | レスポンシブ対応 | PC/タブレット/スマートフォンで利用可能 |
| NFR-302 | ブラウザ対応 | Chrome、Edge、Safari最新版 |
| NFR-303 | 操作性 | 直感的なUI（営業担当者がトレーニングなしで利用可能） |

---

## 4. ユーザーストーリー

### 4.1 営業担当者

| ID | ユーザーストーリー |
|----|-------------------|
| US-001 | As a 営業担当者, I want to 新規案件を素早く登録 so that 商談後すぐに情報を記録できる |
| US-002 | As a 営業担当者, I want to 案件のステータスを更新 so that 進捗を正確に反映できる |
| US-003 | As a 営業担当者, I want to 活動履歴を記録 so that 過去の商談内容を振り返れる |
| US-004 | As a 営業担当者, I want to 自分の担当案件を一覧表示 so that 対応漏れを防げる |

### 4.2 営業マネージャー

| ID | ユーザーストーリー |
|----|-------------------|
| US-101 | As a 営業マネージャー, I want to チーム全体の売上実績を確認 so that 目標達成状況を把握できる |
| US-102 | As a 営業マネージャー, I want to 担当者別の進捗を比較 so that 適切なフォローができる |
| US-103 | As a 営業マネージャー, I want to 月次目標を設定 so that チームの方向性を示せる |
| US-104 | As a 営業マネージャー, I want to データをエクスポート so that 経営報告資料を作成できる |

### 4.3 管理者

| ID | ユーザーストーリー |
|----|-------------------|
| US-201 | As a 管理者, I want to 新規ユーザーを追加 so that チームメンバーがシステムを利用できる |
| US-202 | As a 管理者, I want to ユーザー権限を管理 so that 適切なアクセス制御ができる |

---

## 5. データモデル

### 5.1 テーブル設計

#### **テーブル: projects（案件）**

| カラム名 | データ型 | 制約 | 説明 |
|----------|----------|------|------|
| id | UUID | PRIMARY KEY | 案件ID |
| company_name | VARCHAR(255) | NOT NULL | 企業名 |
| contact_person | VARCHAR(100) | NULL | 担当者名 |
| status | ENUM | NOT NULL | ステータス（lead/negotiation/proposal/won/lost） |
| sales_amount | DECIMAL(15,2) | NOT NULL | 売上金額 |
| gross_profit | DECIMAL(15,2) | NOT NULL | 粗利金額 |
| probability | INTEGER | NOT NULL | 確度（0-100%） |
| category | VARCHAR(50) | NULL | 案件カテゴリ |
| expected_order_month | DATE | NULL | 受注予定月（YYYY-MM-01形式） |
| expected_booking_month | DATE | NULL | 計上予定月（YYYY-MM-01形式） |
| assigned_user_id | UUID | FOREIGN KEY | 担当者ID（users.id参照） |
| created_at | TIMESTAMP | DEFAULT NOW() | 作成日時 |
| updated_at | TIMESTAMP | DEFAULT NOW() | 更新日時 |
| deleted_at | TIMESTAMP | NULL | 削除日時（論理削除） |

#### **テーブル: activities（活動履歴）**

| カラム名 | データ型 | 制約 | 説明 |
|----------|----------|------|------|
| id | UUID | PRIMARY KEY | 活動ID |
| project_id | UUID | FOREIGN KEY | 案件ID（projects.id参照） |
| user_id | UUID | FOREIGN KEY | 記録者ID（users.id参照） |
| activity_type | VARCHAR(50) | NOT NULL | 活動種別（visit/call/email/meeting） |
| content | TEXT | NOT NULL | 活動内容 |
| activity_date | TIMESTAMP | NOT NULL | 活動日時 |
| created_at | TIMESTAMP | DEFAULT NOW() | 記録日時 |

#### **テーブル: monthly_targets（月次目標）**

| カラム名 | データ型 | 制約 | 説明 |
|----------|----------|------|------|
| id | UUID | PRIMARY KEY | 目標ID |
| target_month | DATE | NOT NULL | 対象月（YYYY-MM-01形式） |
| sales_target | DECIMAL(15,2) | NOT NULL | 売上目標 |
| profit_target | DECIMAL(15,2) | NOT NULL | 粗利目標 |
| user_id | UUID | NULL | 担当者ID（NULL=全体目標） |
| created_at | TIMESTAMP | DEFAULT NOW() | 作成日時 |

#### **テーブル: users（ユーザー）**

| カラム名 | データ型 | 制約 | 説明 |
|----------|----------|------|------|
| id | UUID | PRIMARY KEY | ユーザーID（Supabase Auth連携） |
| email | VARCHAR(255) | UNIQUE, NOT NULL | メールアドレス |
| name | VARCHAR(100) | NOT NULL | 氏名 |
| role | ENUM | NOT NULL | 権限（user/manager/admin） |
| created_at | TIMESTAMP | DEFAULT NOW() | 作成日時 |

### 5.2 ER図（テキスト表記）

```
users (1) ----< (*) projects
  |                    |
  |                    |
  +-------< (*) activities
  |
  +-------< (*) monthly_targets
```

---

## 6. 技術アーキテクチャ

### 6.1 技術スタック

| レイヤー | 技術 | 理由 |
|----------|------|------|
| **フロントエンド** | Next.js 14 (App Router) + TypeScript | サーバーアクションでAPI不要、型安全性 |
| **UIライブラリ** | shadcn/UI + Tailwind CSS | 統一感あるデザイン、カスタマイズ容易 |
| **バックエンド** | Next.js Server Actions | フロントと統合、API エンドポイント不要 |
| **データベース** | Supabase (PostgreSQL) | RLS機能、リアルタイム更新、認証統合 |
| **認証** | Supabase Auth | メール認証、セッション管理 |
| **ホスティング** | Vercel | Next.js最適化、自動デプロイ |
| **開発ツール** | VS Code + GitHub Copilot Pro | コーディング効率化 |

### 6.2 システム構成図（テキスト表記）

```
┌─────────────────────────────────────────────┐
│            クライアント (ブラウザ)            │
│  Next.js (React) + shadcn/UI + Tailwind    │
└─────────────────┬───────────────────────────┘
                  │ HTTPS
                  ↓
┌─────────────────────────────────────────────┐
│          Vercel (Next.js App Router)        │
│  ┌─────────────────────────────────────┐   │
│  │  Server Actions (TypeScript)        │   │
│  │  - 案件CRUD処理                      │   │
│  │  - 集計ロジック                      │   │
│  │  - エクスポート処理                  │   │
│  └─────────────────┬───────────────────┘   │
└────────────────────┼───────────────────────┘
                     │ PostgreSQL Protocol
                     ↓
┌─────────────────────────────────────────────┐
│           Supabase                          │
│  ┌───────────────────────────────────────┐ │
│  │  PostgreSQL Database                  │ │
│  │  - projects, activities, targets      │ │
│  │  - Row Level Security (RLS)           │ │
│  └───────────────────────────────────────┘ │
│  ┌───────────────────────────────────────┐ │
│  │  Auth (認証・セッション管理)          │ │
│  └───────────────────────────────────────┘ │
└─────────────────────────────────────────────┘
```

### 6.3 主要機能のフロー

#### **案件登録フロー**
1. ユーザーが案件登録フォームに入力
2. Next.js Server Actionが入力データを受け取り
3. Supabaseにデータを挿入（RLSで自動的にユーザーIDを付与）
4. 成功/エラーをクライアントに返却
5. 案件一覧画面を再表示

#### **ダッシュボード集計フロー**
1. ページロード時にServer Componentで集計クエリ実行
2. Supabaseから当月の案件データと目標データを取得
3. サーバー側で売上実績・予算比・案件数を計算
4. 計算結果をクライアントコンポーネントに渡しグラフ描画

---

## 7. UIプロトタイプ設計

### 7.1 画面構成

| 画面ID | 画面名 | 主要機能 | 優先度 |
|--------|--------|----------|--------|
| SC-001 | ログイン画面 | メール/パスワード入力 | 必須 |
| SC-002 | ダッシュボード | 売上実績、予算比、案件数、グラフ表示 | 必須 |
| SC-003 | 案件一覧 | 検索、フィルタ、ソート、新規登録ボタン | 必須 |
| SC-004 | 案件詳細 | 案件情報、活動履歴、編集ボタン | 必須 |
| SC-005 | 案件登録・編集フォーム | 全項目入力、バリデーション | 必須 |
| SC-006 | 目標設定画面 | 月次目標入力フォーム | 必須 |
| SC-007 | ユーザー管理画面 | ユーザー一覧、追加、権限変更 | 推奨 |

### 7.2 画面ワイヤーフレーム（テキストベース）

#### **SC-002: ダッシュボード**

```
┌──────────────────────────────────────────────────────────┐
│  [ロゴ] 営業案件管理システム          [ユーザー名▼]      │
├──────────────────────────────────────────────────────────┤
│  📊 ダッシュボード | 📋 案件一覧 | 🎯 目標設定 | ⚙️ 設定  │
├──────────────────────────────────────────────────────────┤
│                                                            │
│  【今月の実績】 (2025年10月)                               │
│  ┌─────────────┬─────────────┬─────────────┬─────────┐ │
│  │  売上実績    │  粗利実績    │  予算比      │ 案件数   │ │
│  │  ¥12,500,000 │  ¥3,750,000  │  83.3%       │ 45件     │ │
│  │  目標: ¥15M  │  目標: ¥4.5M │  ━━━━━━━━━  │ 受注:12  │ │
│  └─────────────┴─────────────┴─────────────┴─────────┘ │
│                                                            │
│  【売上推移グラフ】                                        │
│  ┌────────────────────────────────────────────────────┐ │
│  │ (折れ線グラフ: 過去6ヶ月の売上・粗利)                 │ │
│  │ 5月: ¥10M, 6月: ¥12M, 7月: ¥14M, ...                  │ │
│  └────────────────────────────────────────────────────┘ │
│                                                            │
│  【担当者別実績】                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │ 担当者     │ 売上       │ 粗利       │ 案件数        │ │
│  │ 山田太郎   │ ¥3,500,000 │ ¥1,050,000 │ 8件          │ │
│  │ 佐藤花子   │ ¥2,800,000 │ ¥840,000   │ 6件          │ │
│  │ ...        │ ...        │ ...        │ ...          │ │
│  └────────────────────────────────────────────────────┘ │
│                                                            │
│  【カテゴリ別実績】 (円グラフ)                             │
│  ┌────────────────────────────────────────────────────┐ │
│  │ ● 新規: 40% (¥5M)  ● 既存: 35% (¥4.4M)               │ │
│  │ ● アップセル: 25% (¥3.1M)                             │ │
│  └────────────────────────────────────────────────────┘ │
│                                                            │
└──────────────────────────────────────────────────────────┘
```

#### **SC-003: 案件一覧**

```
┌──────────────────────────────────────────────────────────┐
│  📋 案件一覧                                               │
├──────────────────────────────────────────────────────────┤
│  🔍 検索: [企業名/担当者]  ステータス: [全て▼]           │
│  カテゴリ: [全て▼]  受注予定月: [指定なし▼]  [+ 新規登録]│
├──────────────────────────────────────────────────────────┤
│  企業名       │ 担当者 │ ステータス │ 売上      │ 確度   │ │
│  ─────────────┼────────┼────────────┼───────────┼────── │ │
│  A商事株式会社│ 山田   │ 🟡 提案    │ ¥2,000,000│ 70%   │ │
│  B物産        │ 佐藤   │ 🟢 受注    │ ¥1,500,000│ 100%  │ │
│  C工業        │ 田中   │ 🔵 商談    │ ¥3,000,000│ 50%   │ │
│  ...          │ ...    │ ...        │ ...       │ ...   │ │
├──────────────────────────────────────────────────────────┤
│  全45件を表示中  [⬅️ 前へ] [1] [2] [3] [次へ ➡️]           │
│  [📥 Excelエクスポート] [📄 CSVエクスポート]               │
└──────────────────────────────────────────────────────────┘
```

#### **SC-004: 案件詳細**

```
┌──────────────────────────────────────────────────────────┐
│  📋 案件詳細: A商事株式会社          [✏️ 編集] [🗑️ 削除]  │
├──────────────────────────────────────────────────────────┤
│  【基本情報】                                              │
│  企業名: A商事株式会社                                     │
│  担当者: 山田太郎 (営業部長)                               │
│  ステータス: 🟡 提案                                       │
│  売上: ¥2,000,000  粗利: ¥600,000  確度: 70%              │
│  カテゴリ: 新規                                            │
│  受注予定月: 2025年11月  計上予定月: 2025年12月           │
│  作成日: 2025-10-15  更新日: 2025-10-28                   │
│                                                            │
│  【活動履歴】                      [+ 活動を追加]          │
│  ┌────────────────────────────────────────────────────┐ │
│  │ 2025-10-28 15:30 | 訪問 | 佐藤                        │ │
│  │ 提案書を持参し、詳細説明。予算確保の見込みあり。      │ │
│  │                                                        │ │
│  │ 2025-10-20 10:00 | 商談 | 佐藤                        │ │
│  │ 初回商談。ニーズヒアリング完了。次回提案予定。        │ │
│  └────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────┘
```

#### **SC-005: 案件登録・編集フォーム**

```
┌──────────────────────────────────────────────────────────┐
│  📝 案件登録                                               │
├──────────────────────────────────────────────────────────┤
│  企業名 *           [________________]                     │
│  担当者             [________________]                     │
│  ステータス *       [リード ▼]                            │
│  売上金額 *         [¥ ____________]                       │
│  粗利金額 *         [¥ ____________]                       │
│  確度 (%) *         [________] %                           │
│  案件カテゴリ       [新規 ▼]                              │
│  受注予定月         [2025-11 ▼]                           │
│  計上予定月         [2025-12 ▼]                           │
│                                                            │
│  [キャンセル]                           [保存]            │
└──────────────────────────────────────────────────────────┘
```

---

## 8. 次のステップ

### 8.1 実装フェーズ

**Phase 1: 基盤構築（Week 1-2）**
- Next.jsプロジェクトセットアップ
- Supabase接続設定
- 認証機能実装
- データベーステーブル作成

**Phase 2: コア機能実装（Week 3-5）**
- 案件CRUD機能
- 活動履歴機能
- ダッシュボード集計ロジック

**Phase 3: 追加機能（Week 6-7）**
- 目標管理機能
- エクスポート機能
- グラフ描画

**Phase 4: 仕上げ（Week 8）**
- UI/UX改善
- パフォーマンス最適化
- テスト・デバッグ

